{"title":"Spring Session Note","date":"2020-04-24T14:03:14.000Z","date_formatted":{"ll":"Apr 24, 2020","L":"04/24/2020","MM-DD":"04-24"},"thumbnail":"https://img.cdn.n3ko.co/lsky/2020/04/24/4eba02e7ea698.jpg?x-oss-process=image/auto-orient,1/quality,q_70/sharpen,200/format,webp","link":"2020/04/24/Spring-Session-Note","comments":true,"tags":["Java","Spring"],"categories":["Programming"],"updated":"2020-04-25T15:09:33.900Z","content":"<h2 id=\"dependencies\">Dependencies<a href=\"#dependencies\" title=\"Dependencies\"></a></h2><p>Spring Session includes <code>Spring Session Core</code>, <code>Spring Session Data Redis</code>, <code>Sping Session JDBC</code>, <code>Spring Session Hazelcast</code>. </p>\n<p>It is recommended to declare BOM(Bill of Materials) first before you add corresponding dependencies if youâ€™re using maven, but it is completely fine without doing so.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--pom.xml--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.session<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-session-bom<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>Corn-SR2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"integrated-in-spring-boot\">Integrated in Spring boot<a href=\"#integrated-in-spring-boot\" title=\"Integrated in Spring boot\"></a></h2><blockquote>\n<p><a href=\"https://docs.spring.io/spring-session/docs/current/reference/html5/guides/boot-redis.html\" target=\"_blank\">https://docs.spring.io/spring-session/docs/current/reference/html5/guides/boot-redis.html</a></p>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-session\" target=\"_blank\">https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-session</a></p>\n</blockquote>\n<h3 id=\"store-session-in-redis\">Store Session in Redis<a href=\"#store-session-in-redis\" title=\"Store Session in Redis\"></a></h3><ol><li><p>Import dependencies.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--pom.xml--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- ... --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.session<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-session-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Spring Data Redis merely provides <code>redisTemplate</code> to operate Redis. It is suggested to use <code>jedis</code> or <code>lettuce</code>. </p>\n<p><code>jedis</code> provides more flexible APIs to operate Redis. However,<code>jedis</code> uses blocked I/O .Its methods are not thread-safe, and thus you need to manually build a <code>jedisPool</code> yourself.  </p>\n<p><code>lettuce</code> works pretty well in distribution environment. It supports sentinel and many other advanced features.</p>\n</li>\n<li><p>Configure in <code>application.yml</code>/<code>application.properties</code></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">localhost</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">redis-password</span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">session:</span></span><br><span class=\"line\">    <span class=\"attr\">store-type:</span> <span class=\"string\">redis</span> </span><br><span class=\"line\">    <span class=\"comment\"># Could be jdbc/redis/hazelcast/mongodb, depending on the dependency</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">flush-mode:</span> <span class=\"string\">on_save</span>  <span class=\"comment\"># Sessions flush mode.</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">spring:session</span> <span class=\"comment\"># Namespace for keys used to store sessions.</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">session:</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">10m</span> <span class=\"comment\"># session timeout in 10 min</span></span><br></pre></td></tr></table></figure>\n\n<p>In starter class:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableRedisHttpSession</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoApplication</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">        SpringApplication.run(DemoApplication<span class=\"class\">.<span class=\"keyword\">class</span>,<span class=\"title\">args</span>)</span>;</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Test with Controller:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">login</span><span class=\"params\">(String username,String password, HttpSession session)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(session.getAttribute(<span class=\"string\">\"username\"</span>)==<span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        session.setAttribute(<span class=\"string\">\"username\"</span>,username);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"index\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>If successful, a record starts with <code>spring:session</code> should be found in Redis database.</p>\n</li>\n</ol>","next":{"title":"Spring Data JPA Note","link":"2020/04/19/Spring-Data-JPA-notes"},"plink":"https://git.michaelsblog.top/2020/04/24/Spring-Session-Note/","toc":[{"id":"dependencies","title":"Dependencies","index":"1"},{"id":"integrated-in-spring-boot","title":"Integrated in Spring boot","index":"2","children":[{"id":"store-session-in-redis","title":"Store Session in Redis","index":"2.1"}]}]}